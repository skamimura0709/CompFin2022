
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>第11回 機械学習入門2 勾配降下法、ロジスティック回帰、クラスタリング &#8212; コンピュテーショナル・ファイナンス</title>
    
  <link href="_static/css/theme.css" rel="stylesheet">
  <link href="_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="第12回 機械学習入門3 決定木" href="12CompFin.html" />
    <link rel="prev" title="第10回 機械学習入門1 線形回帰モデル" href="10CompFin.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
      
      
      <h1 class="site-logo" id="site-title">コンピュテーショナル・ファイナンス</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="この本を検索..." aria-label="この本を検索..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="intro.html">
   コンピュテーショナル・ファイナンス
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="01CompFin.html">
   第1回 Pythonの基礎1
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="02CompFin.html">
   第2回 Pyhtonの基礎2
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="03CompFin.html">
   第3回 NumpyとPandas（金融時系列データ）
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="04CompFin.html">
   第4回 関数、行列、最適化
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="05CompFin.html">
   第5回 確率過程と確率微分方程式
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="06CompFin.html">
   第6回 ツリーモデル1
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="07CompFin.html">
   第7回 ツリーモデル2
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="08CompFin.html">
   第8回 モンテカルロ法1
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="09CompFin.html">
   第9回 モンテカルロ法2
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="10CompFin.html">
   第10回 機械学習入門1 線形回帰モデル
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   第11回 機械学習入門2 勾配降下法、ロジスティック回帰、クラスタリング
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="12CompFin.html">
   第12回 機械学習入門3 決定木
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="13CompFin.html">
   第13回 ニューラルネットワーク
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="ナビゲーションを切り替え" aria-controls="site-navigation"
                title="ナビゲーションを切り替え" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="このページをダウンロード"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/11CompFin.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="ソースファイルをダウンロード" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="PDFに印刷"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="全画面モード"
        title="全画面モード"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/skamimura0709/CompFin2022/gh-pages?urlpath=tree/_sources/11CompFin.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="発売 Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/skamimura0709/CompFin2022/blob/gh-pages/_sources/11CompFin.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="発売 Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> 目次
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id2">
   勾配降下法
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id3">
   確率的勾配降下法による線形回帰問題
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id4">
   ロジスティック回帰による分類問題
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id5">
     がんデータの分析: 2クラス分類
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id6">
     2値分類
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id7">
     多クラス分類
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#k-means">
   教師なし学習: k-means法によるクラスタリング
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>第11回 機械学習入門2 勾配降下法、ロジスティック回帰、クラスタリング</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> 目次 </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id2">
   勾配降下法
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id3">
   確率的勾配降下法による線形回帰問題
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id4">
   ロジスティック回帰による分類問題
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id5">
     がんデータの分析: 2クラス分類
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id6">
     2値分類
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id7">
     多クラス分類
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#k-means">
   教師なし学習: k-means法によるクラスタリング
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="id1">
<h1>第11回 機械学習入門2 勾配降下法、ロジスティック回帰、クラスタリング<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
</div>
<div class="section" id="id2">
<h2>勾配降下法<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>機械学習においては損失関数 <span class="math notranslate nohighlight">\(L(\mathbf{w})\)</span> の最小化問題</p>
<div class="math notranslate nohighlight">
\[ \tag{1}
  \min_{\mathbf{w}} L(\mathbf{w})
\]</div>
<p>を解くことが鍵となる。例えば、線形回帰モデルにおいては、損失関数は</p>
<div class="math notranslate nohighlight">
\[
  L(\mathbf{w}) = \frac{1}{N}\sum_{i=1}^N\left(y_i - w_0 - \sum_{j=1}^Dw_jx_{ij}\right)^2 =\frac{1}{N}\sum_{i=1}^N\left(y_i - \mathbf{w}^T \mathbf{x}_i\right)^2
\]</div>
<p>であった。線形回帰の場合など <span class="math notranslate nohighlight">\(\nabla L(\mathbf{w})=0\)</span> が解析的に解ける、すなわち <span class="math notranslate nohighlight">\(\textbf{w}=\cdots\)</span> という表現を得られることがある。
しかし、機械学習ではデータの個数・次元が非常に大きく、解析的表現による解法は実用的ではないことが多い。
そこで、反復法を用いて(1)を解くことが多い。</p>
<p>もし <span class="math notranslate nohighlight">\(\mathbf{w}^*\)</span>が(1)の解であるならば</p>
<div class="math notranslate nohighlight">
\[ \tag{2}
  \nabla L(\mathbf{w}^*) = 0
\]</div>
<p>を満たす。ここで <span class="math notranslate nohighlight">\(\nabla L(\mathbf{w})\)</span> は勾配ベクトルで</p>
<div class="math notranslate nohighlight">
\[
  \nabla L(\mathbf{w})=\left(\frac{\partial L}{\partial w_1}\left(\mathbf{w}\right),\frac{\partial L}{\partial w_2}\left(\mathbf{w}\right),\ldots,\frac{\partial L}{\partial w_D}\left(\mathbf{w}\right)\right)^T
\]</div>
<p>により定義される。
ここで、<span class="math notranslate nohighlight">\(D\)</span>はベクトル<span class="math notranslate nohighlight">\(\mathbf{w}\)</span>の要素数を表す。<span class="math notranslate nohighlight">\(\mathbf{w}\)</span> が1次元の場合は通常の微分 <span class="math notranslate nohighlight">\(L'(w)\)</span> である。</p>
<p>しかし、ある <span class="math notranslate nohighlight">\(\mathbf{w}\)</span> が (2) を満たしたとしても，
それが最小化問題 (1) の解になるとは限らず、
局所的最適解になっている可能性がある。</p>
<p>[大域的最適解と局所的最適解の図を挿入]</p>
<p>局所的最適解に対して、(1)の解を大域的最適解と呼ぶ。
関数 <span class="math notranslate nohighlight">\(L\)</span> が凸関数であるときには、条件(2)を満たす <span class="math notranslate nohighlight">\(\mathbf{w}\)</span> は大域的最適解になる。
関数 <span class="math notranslate nohighlight">\(L\)</span> が条件</p>
<div class="math notranslate nohighlight">
\[
  L(t\mathbf{w}_1+\left(1-t\right)\mathbf{w}_2) \leq t L(\mathbf{w}_1)+(1-t)L(\mathbf{w}_2),\ \forall t\in\left[0,1\right],\ \ \forall\mathbf{w}_1,\mathbf{w}_2  
\]</div>
<p>を満たすとき、凸関数であるという。</p>
<p>[凸関数の図を挿入]</p>
<p>いくつかのモデルでは損失関数は凸関数となるが、ニューラルネットワークなどでは損失関数が必ずしも凸にならないので、注意が必要となる。
非凸関数に対して(1)を解くことは一般には難しく、
通常は局所的最適解を求めることで満足することが多い。
以下でも、局所最適解を求める手法のみを考える。</p>
<p>勾配ベクトル <span class="math notranslate nohighlight">\(\nabla L\)</span> の情報をもとに (1) の解を近似する手法を
<strong>勾配降下法</strong>という。
一般に実数値関数 <span class="math notranslate nohighlight">\(f(\mathbf{w})\)</span> について、ベクトル <span class="math notranslate nohighlight">\(\mathbf{d}\)</span> に対して，
ある実数 <span class="math notranslate nohighlight">\(\eta &gt; 0\)</span> が存在して<span class="math notranslate nohighlight">\(f(\mathbf{w}+\eta\mathbf{d})&lt;f(\mathbf{w})\)</span>
となるとき、ベクトル <span class="math notranslate nohighlight">\(\mathbf{d}\)</span> を <span class="math notranslate nohighlight">\(\mathbf{w}\)</span> における降下方向とよぶ。</p>
<p><span class="math notranslate nohighlight">\(\nabla f(\mathbf{w})^T \mathbf{d}&lt;0\)</span> を満たす <span class="math notranslate nohighlight">\(\mathbf{d}\)</span> は降下方向である。
なぜなら、十分小さく <span class="math notranslate nohighlight">\(η &gt; 0\)</span> を取れば、テイラーの定理より</p>
<div class="math notranslate nohighlight">
\[
  f(\mathbf{w} + \eta \mathbf{d}) \approx f(\mathbf{w}) + \eta \nabla f(\mathbf{w})^T \mathbf{d}
\]</div>
<p>であるから、<span class="math notranslate nohighlight">\(\nabla f(\mathbf{w})^T \mathbf{d}&lt;0\)</span> より
<span class="math notranslate nohighlight">\(f(\mathbf{w}+\eta\mathbf{d}) &lt; f(\mathbf{w})\)</span> とすることができる。
<span class="math notranslate nohighlight">\(\mathbf{d}=-\nabla f(\mathbf{w})\)</span> が <span class="math notranslate nohighlight">\(\mathbf{w}\)</span> における降下方向になることはすぐに分かる。
<span class="math notranslate nohighlight">\(\mathbf{w}\)</span> が1次元の場合、<span class="math notranslate nohighlight">\(-f'(\mathbf{w})\)</span> が降下方向であることは明らかであろう。</p>
<p><strong>勾配降下法</strong>（最急降下法）は、つぎのような反復法である。</p>
<ol class="simple">
<li><p>適当な初期点 <span class="math notranslate nohighlight">\(\mathbf{w}(0)\)</span> を選び、<span class="math notranslate nohighlight">\(k=0\)</span> とする。</p></li>
<li><p><span class="math notranslate nohighlight">\(L(\mathbf{w}(k)) =0\)</span> ならば解を
<span class="math notranslate nohighlight">\(\mathbf{w}^*=\mathbf{w}(k)\)</span> として、反復法を終了する。</p></li>
<li><p>適当なステップ幅 <span class="math notranslate nohighlight">\(\eta(k)&gt;0\)</span> に対して
<span class="math notranslate nohighlight">\(\mathbf{w}(k+1) = \mathbf{w}(k) - \eta(k)\nabla L(\mathbf{w}(k))\)</span>
とする。</p></li>
<li><p><span class="math notranslate nohighlight">\(k := k + 1\)</span> （<span class="math notranslate nohighlight">\(k\)</span> の値を1増やす）としてステップ2に戻る。</p></li>
</ol>
<p>すなわち、勾配降下法とは点 <span class="math notranslate nohighlight">\(\mathbf{w}(0)\)</span> から関数 <span class="math notranslate nohighlight">\(L\)</span> が減少する方向
<span class="math notranslate nohighlight">\(-\nabla L(\mathbf{w}(0))\)</span> に沿って少し進み点 <span class="math notranslate nohighlight">\(\mathbf{w}(1)\)</span>
に到達、そこで <span class="math notranslate nohighlight">\(-\nabla L(\mathbf{w}(1))\)</span> に方向を変えてさらに少し進んで点 <span class="math notranslate nohighlight">\(\mathbf{w}(2)\)</span> に到達、そこで <span class="math notranslate nohighlight">\(-\nabla L(\mathbf{w}(2))\)</span> に方向を変えて、という手続きを <span class="math notranslate nohighlight">\(\nabla L(\mathbf{w}(k))=0\)</span> となるまで続ける、というアルゴリズムである。</p>
<p>[勾配降下法の挿入]</p>
<p>各ステップで設定するステップ幅 <span class="math notranslate nohighlight">\(\eta (k)\)</span> を機械学習では学習率と呼ぶ。
機械学習において分析者があらかじめ設定すべきパラメータをハイパーパラメータと呼び、学習率はハイパーパラメータの一つである。
学習率をステップ <span class="math notranslate nohighlight">\(k\)</span> によらず一定値 <span class="math notranslate nohighlight">\(\eta\)</span> とすることもある。
学習率の設定法については問題に応じていろいろな手法が開発されているが，決定的な方法は存在せず、試行錯誤により設定せざるを得ない。</p>
<p>機械学習では最小化する関数が</p>
<div class="math notranslate nohighlight">
\[
   L(\mathbf{w}) = \frac{1}{N}\sum_{i=1}^Nl(\mathbf{x}_i,y_i;\mathbf{w})
\]</div>
<p>という形をしている。
機械学習においては訓練データ数 <span class="math notranslate nohighlight">\(N\)</span> は非常に大きい。
したがって，損失関数の勾配の式</p>
<div class="math notranslate nohighlight">
\[
  \nabla L(\mathbf{w}) = \frac{1}{N}\sum_{i=1}^N \nabla l(\mathbf{x}_i,y_i;\mathbf{w})
\]</div>
<p>から分かるように、勾配降下法において損失関数の勾配を求めるたびに <span class="math notranslate nohighlight">\(N\)</span> 個の勾配
<span class="math notranslate nohighlight">\(\{\nabla l(\mathbf{x}_i,y_i;\mathbf{w})\}_{i=1,…,N}\)</span> の計算が必要になり計算負荷が非常に大きくなってしまう。
そこで <span class="math notranslate nohighlight">\(N\)</span> 個のデータをすべて使わずに、1つまたは少数のデータのみを使って勾配ベクトルを計算する、<strong>確率的勾配降下法</strong>という反復法を用いる。
確率的勾配降下法では勾配降下法のステップ3がつぎのようになる:</p>
<ol class="simple">
<li><p>（ランダムに）選んだ訓練データ <span class="math notranslate nohighlight">\((\mathbf{x}_i,y_i)\)</span> を用いて <span class="math notranslate nohighlight">\(\nabla l(\mathbf{x}_i,y_i;\mathbf{w}(k))\)</span> を計算し，適当なステップ幅 <span class="math notranslate nohighlight">\(\eta(k)&gt;0\)</span>  に対して</p></li>
</ol>
<div class="math notranslate nohighlight">
\[
      w(k+1) = w(k) - \eta(k)\nabla l(\mathbf{x}_i,y_i;\mathbf{w}(k))
\]</div>
<p>とする（他のステップは勾配降下法と同じ）。</p>
<p>勾配の計算に用いる訓練データ <span class="math notranslate nohighlight">\((\mathbf{x}_i,y_i)\)</span> はランダムに選んでもよいし，何らかの順序に従って選んでもよい。</p>
</div>
<div class="section" id="id3">
<h2>確率的勾配降下法による線形回帰問題<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<p>scikit-learnライブラリの<code class="docutils literal notranslate"><span class="pre">SGDRegressor</span></code>クラスを使うと確率的勾配降下法により線形回帰問題を解くことができる。<code class="docutils literal notranslate"><span class="pre">SGDRegressor</span></code>についてはつぎを参照: <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.SGDRegressor.html">https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.SGDRegressor.html</a></p>
<p>データ数が多いとき（100000以上？）には確率的勾配法を使ったほうがよい。
参考: <a class="reference external" href="https://scikit-learn.org/stable/tutorial/machine_learning_map/index.html">https://scikit-learn.org/stable/tutorial/machine_learning_map/index.html</a></p>
<p><code class="docutils literal notranslate"><span class="pre">SGDRegressor</span></code>はデフォルトでRidge回帰を行う。Boston Housing Datasetを確率勾配降下法を使って解いてみる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># boston_df = pd.read_csv(&#39;&#39;)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_df</span> <span class="o">=</span> <span class="n">boston_df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;INDEX&#39;</span><span class="p">,</span> <span class="s1">&#39;MEDV&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y_df</span> <span class="o">=</span> <span class="n">boston_df</span><span class="p">[</span><span class="s1">&#39;MEDV&#39;</span><span class="p">]</span>
<span class="n">X_np</span> <span class="o">=</span> <span class="n">X_df</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">y_np</span> <span class="o">=</span> <span class="n">y_df</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">Input In [3],</span> in <span class="ni">&lt;cell line: 1&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">X_df</span> <span class="o">=</span> <span class="n">boston_df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;INDEX&#39;</span><span class="p">,</span> <span class="s1">&#39;MEDV&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">y_df</span> <span class="o">=</span> <span class="n">boston_df</span><span class="p">[</span><span class="s1">&#39;MEDV&#39;</span><span class="p">]</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">X_np</span> <span class="o">=</span> <span class="n">X_df</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

<span class="ne">NameError</span>: name &#39;boston_df&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X_np</span><span class="p">,</span> <span class="n">y_np</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
<span class="n">scaler</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">X_train_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">X_test_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>確率的勾配降下法を実行する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">SGDRegressor</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sgdr</span> <span class="o">=</span> <span class="n">SGDRegressor</span><span class="p">(</span><span class="n">penalty</span><span class="o">=</span><span class="s1">&#39;l2&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">sgdr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_scaled</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>SGDRegressor(alpha=0.1)
</pre></div>
</div>
</div>
</div>
<p>スコアの計算</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">sgdr</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test_scaled</span><span class="p">,</span> <span class="n">y_test</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sgdr</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_train_scaled</span><span class="p">,</span> <span class="n">y_train</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.6787136061328078
0.74220129183512
</pre></div>
</div>
</div>
</div>
<p>回帰係数の表示</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">colnames</span> <span class="o">=</span> <span class="n">X_df</span><span class="o">.</span><span class="n">columns</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">sgdr</span><span class="o">.</span><span class="n">coef_</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">colnames</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
  <div id="df-5fcf4ba8-317d-49b1-89eb-2a286afe8ac0">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>CRIM</th>
      <td>-0.710814</td>
    </tr>
    <tr>
      <th>ZN</th>
      <td>0.605634</td>
    </tr>
    <tr>
      <th>INDUS</th>
      <td>-0.220896</td>
    </tr>
    <tr>
      <th>CHAS</th>
      <td>0.364819</td>
    </tr>
    <tr>
      <th>NOX</th>
      <td>-0.968677</td>
    </tr>
    <tr>
      <th>RM</th>
      <td>3.202851</td>
    </tr>
    <tr>
      <th>AGE</th>
      <td>-0.126298</td>
    </tr>
    <tr>
      <th>DIS</th>
      <td>-2.000007</td>
    </tr>
    <tr>
      <th>RAD</th>
      <td>0.890120</td>
    </tr>
    <tr>
      <th>TAX</th>
      <td>-0.724289</td>
    </tr>
    <tr>
      <th>PTRATIO</th>
      <td>-1.727948</td>
    </tr>
    <tr>
      <th>B</th>
      <td>0.593575</td>
    </tr>
    <tr>
      <th>LSTAT</th>
      <td>-3.394217</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-5fcf4ba8-317d-49b1-89eb-2a286afe8ac0')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-5fcf4ba8-317d-49b1-89eb-2a286afe8ac0 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-5fcf4ba8-317d-49b1-89eb-2a286afe8ac0');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
</div></div>
</div>
<p>オプションに<code class="docutils literal notranslate"><span class="pre">penalty='l1</span></code>を指定して、Lasso回帰を実行し、係数の変化を見てみる。</p>
</div>
<div class="section" id="id4">
<h2>ロジスティック回帰による分類問題<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id5">
<h3>がんデータの分析: 2クラス分類<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>がん細胞のデータ <a class="reference external" href="https://drive.google.com/file/d/10DH1G-A6LkKX5lWJ8hlNQUAWlP1wlOb-/view?usp=sharing">cancer.csv</a> を使って2クラスの分類問題を解く。
データは細胞の画像から作成されたデータとその細胞が悪性か良性かが記録されたものである。データの詳細は <a class="reference external" href="https://www.kaggle.com/uciml/breast-cancer-wisconsin-data">https://www.kaggle.com/uciml/breast-cancer-wisconsin-data</a> を参照せよ。</p>
<p>特徴量は細胞の形状等に関するデータ、正解は悪性（0）から良性（1）かを表すデータになる。正解が2つの値から成るので<strong>2クラス分類問題</strong>という。</p>
<p>まずデータを観察する。</p>
<p>Googleドライブをマウントして、データ<code class="docutils literal notranslate"><span class="pre">cancer.csv</span></code>を読み込む。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cancer_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>データの先頭を見る。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cancer_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
  <div id="df-0cded6c5-fb7e-44dc-8416-21bc775b9e0a">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>radius_mean</th>
      <th>texture_mean</th>
      <th>perimeter_mean</th>
      <th>area_mean</th>
      <th>smoothness_mean</th>
      <th>compactness_mean</th>
      <th>concavity_mean</th>
      <th>concave points_mean</th>
      <th>symmetry_mean</th>
      <th>fractal_dimension_mean</th>
      <th>...</th>
      <th>texture_worst</th>
      <th>perimeter_worst</th>
      <th>area_worst</th>
      <th>smoothness_worst</th>
      <th>compactness_worst</th>
      <th>concavity_worst</th>
      <th>concave points_worst</th>
      <th>symmetry_worst</th>
      <th>fractal_dimension_worst</th>
      <th>diagnosis</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>17.99</td>
      <td>10.38</td>
      <td>122.80</td>
      <td>1001.0</td>
      <td>0.11840</td>
      <td>0.27760</td>
      <td>0.3001</td>
      <td>0.14710</td>
      <td>0.2419</td>
      <td>0.07871</td>
      <td>...</td>
      <td>17.33</td>
      <td>184.60</td>
      <td>2019.0</td>
      <td>0.1622</td>
      <td>0.6656</td>
      <td>0.7119</td>
      <td>0.2654</td>
      <td>0.4601</td>
      <td>0.11890</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>20.57</td>
      <td>17.77</td>
      <td>132.90</td>
      <td>1326.0</td>
      <td>0.08474</td>
      <td>0.07864</td>
      <td>0.0869</td>
      <td>0.07017</td>
      <td>0.1812</td>
      <td>0.05667</td>
      <td>...</td>
      <td>23.41</td>
      <td>158.80</td>
      <td>1956.0</td>
      <td>0.1238</td>
      <td>0.1866</td>
      <td>0.2416</td>
      <td>0.1860</td>
      <td>0.2750</td>
      <td>0.08902</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>19.69</td>
      <td>21.25</td>
      <td>130.00</td>
      <td>1203.0</td>
      <td>0.10960</td>
      <td>0.15990</td>
      <td>0.1974</td>
      <td>0.12790</td>
      <td>0.2069</td>
      <td>0.05999</td>
      <td>...</td>
      <td>25.53</td>
      <td>152.50</td>
      <td>1709.0</td>
      <td>0.1444</td>
      <td>0.4245</td>
      <td>0.4504</td>
      <td>0.2430</td>
      <td>0.3613</td>
      <td>0.08758</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>11.42</td>
      <td>20.38</td>
      <td>77.58</td>
      <td>386.1</td>
      <td>0.14250</td>
      <td>0.28390</td>
      <td>0.2414</td>
      <td>0.10520</td>
      <td>0.2597</td>
      <td>0.09744</td>
      <td>...</td>
      <td>26.50</td>
      <td>98.87</td>
      <td>567.7</td>
      <td>0.2098</td>
      <td>0.8663</td>
      <td>0.6869</td>
      <td>0.2575</td>
      <td>0.6638</td>
      <td>0.17300</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>20.29</td>
      <td>14.34</td>
      <td>135.10</td>
      <td>1297.0</td>
      <td>0.10030</td>
      <td>0.13280</td>
      <td>0.1980</td>
      <td>0.10430</td>
      <td>0.1809</td>
      <td>0.05883</td>
      <td>...</td>
      <td>16.67</td>
      <td>152.20</td>
      <td>1575.0</td>
      <td>0.1374</td>
      <td>0.2050</td>
      <td>0.4000</td>
      <td>0.1625</td>
      <td>0.2364</td>
      <td>0.07678</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 31 columns</p>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-0cded6c5-fb7e-44dc-8416-21bc775b9e0a')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-0cded6c5-fb7e-44dc-8416-21bc775b9e0a button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-0cded6c5-fb7e-44dc-8416-21bc775b9e0a');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
</div></div>
</div>
<p>データの大きさを見る。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cancer_df</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
</div>
<p>データの統計量を見る。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cancer_df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>radius_mean と texture_mean を取り出して見てみる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sample_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;radius_mean&#39;</span><span class="p">,</span> <span class="s1">&#39;texture_mean&#39;</span><span class="p">,</span> <span class="s1">&#39;diagnosis&#39;</span><span class="p">]</span>
<span class="n">sample_df</span> <span class="o">=</span> <span class="n">cancer_df</span><span class="p">[</span><span class="n">sample_list</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Numpy配列に変換</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sample_np</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sample_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">(radius_mean,</span> <span class="pre">texture_mean)</span></code>の散布図を描く。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mlignant</span> <span class="o">=</span> <span class="n">sample_df</span><span class="p">[</span><span class="n">sample_df</span><span class="p">[</span><span class="s1">&#39;diagnosis&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span>
<span class="n">benign</span> <span class="o">=</span> <span class="n">sample_df</span><span class="p">[</span><span class="n">sample_df</span><span class="p">[</span><span class="s1">&#39;diagnosis&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;radius_mean&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;texture_mean&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">mlignant</span><span class="p">[</span><span class="s1">&#39;radius_mean&#39;</span><span class="p">],</span> <span class="n">mlignant</span><span class="p">[</span><span class="s1">&#39;texture_mean&#39;</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">benign</span><span class="p">[</span><span class="s1">&#39;radius_mean&#39;</span><span class="p">],</span> <span class="n">benign</span><span class="p">[</span><span class="s1">&#39;texture_mean&#39;</span><span class="p">],</span>  <span class="n">c</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/11CompFin_30_0.png" src="_images/11CompFin_30_0.png" />
</div>
</div>
<p>赤（良性）と青（悪性）の点を完全に分ける直線は引けそうにないが、なるべく上手に分ける直線を引きたい。</p>
</div>
<div class="section" id="id6">
<h3>2値分類<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>正解が2つの値（<span class="math notranslate nohighlight">\(0\)</span>と<span class="math notranslate nohighlight">\(1\)</span>とする）をとるときの分類問題を考える。
正解<span class="math notranslate nohighlight">\(y\)</span>と特徴量 <span class="math notranslate nohighlight">\(x_1, x_2, \dots, x_D\)</span>の関係をパラメータ <span class="math notranslate nohighlight">\(\mathbf{w} =(w_0, w_1, \dots, w_D)^T\)</span> を用いて</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{cases}
\mathbf{w}^T\mathbf{x} \geq 0 &amp;\text{ならば}\ y = 1\\
\mathbf{w}^T\mathbf{x} &lt; 0 &amp;\text{ならば}\ y = 0\\
\end{cases}
\end{split}\]</div>
<p>となるように<span class="math notranslate nohighlight">\(\mathbf{w}\)</span>を決めるのではうまく行かない。ここで、
<span class="math notranslate nohighlight">\(\mathbf{x} = (1, x_1, x_2, \dots, x_D)^T\)</span> とおいた。</p>
<p>ロジスティック回帰では<strong>シグモイド関数</strong></p>
<div class="math notranslate nohighlight">
\[
\sigma(x) = \frac{1}{1+e^{-x}}
\]</div>
<p>を使って、</p>
<div class="math notranslate nohighlight">
\[\begin{split} 
\begin{cases}
\sigma\left(\mathbf{w}^T\mathbf{x}\right) \geq 0.5 &amp;\text{ならば}\ y = 1 \quad (3)\\
\sigma\left(\mathbf{w}^T\mathbf{x}\right) &lt; 0.5 &amp;\text{ならば}\ y = 0\\
\end{cases}
\end{split}\]</div>
<p>となるように<span class="math notranslate nohighlight">\(w_0, w_1, \dots, w_n\)</span>を決める。
シグモイド関数<span class="math notranslate nohighlight">\(\sigma(x)\)</span>は<span class="math notranslate nohighlight">\(0\)</span>以上<span class="math notranslate nohighlight">\(1\)</span>以下の値を取る関数であり、確率とみなすことができる。</p>
<p>[シグモイド関数の図を挿入]</p>
<p>つまり、今の例だと
<span class="math notranslate nohighlight">\(\sigma(\mathbf{w}^T\mathbf{x})\)</span>は<span class="math notranslate nohighlight">\(y=1\)</span>である確率を表す。
そこで、いま、クラス<span class="math notranslate nohighlight">\(C_1\)</span>, <span class="math notranslate nohighlight">\(C_2\)</span> をそれぞれ <span class="math notranslate nohighlight">\(y=1\)</span>, <span class="math notranslate nohighlight">\(y=0\)</span> となる事象とおいて、特徴量 <span class="math notranslate nohighlight">\(\mathbf{x}\)</span> がクラス <span class="math notranslate nohighlight">\(C_i\)</span>（<span class="math notranslate nohighlight">\(i=1, 2\)</span>）に含まれる確率
<span class="math notranslate nohighlight">\(P(C_i | \mathbf{x} ; \mathbf{w})\)</span> を</p>
<div class="math notranslate nohighlight">
\[
P(C_1 | \mathbf{x} ; \mathbf{w}) = \sigma\left(\mathbf{w}^T\mathbf{x}\right)
\]</div>
<p>と定義する。<span class="math notranslate nohighlight">\(P(C_2 | \mathbf{x} ; \mathbf{w}) = 1 - P(C_1 | \mathbf{x} ; \mathbf{w})\)</span> である。</p>
<p>例えば、計算の結果</p>
<div class="math notranslate nohighlight">
\[
\sigma\left(\mathbf{w}^T\mathbf{x}\right) = 0.6
\]</div>
<p>となったときは、<span class="math notranslate nohighlight">\(y=1\)</span>となる確率が<span class="math notranslate nohighlight">\(0.6\)</span>、したがって<span class="math notranslate nohighlight">\(y=0\)</span>となる確率が<span class="math notranslate nohighlight">\(0.4\)</span>なので<span class="math notranslate nohighlight">\(y=1\)</span>と予測することになる。</p>
<p>係数<span class="math notranslate nohighlight">\(\mathbf{w}\)</span>は<strong>最尤法</strong>により推定する。</p>
<p>訓練データ <span class="math notranslate nohighlight">\(\{(\mathbf{x}_i,y_i)\}_{i=1,2,…,N}\)</span> が観測される確率は</p>
<div class="math notranslate nohighlight">
\[
P(\mathbf{w}) = \prod_{i=1}^N P(C_1 | \mathbf{x}_i ; \mathbf{w})^{y_i} (1 - P(C_1 | \mathbf{x}_i ; \mathbf{w}))^{1 - y_i}
\]</div>
<p>となる。
この <span class="math notranslate nohighlight">\(P(\mathbf{w})\)</span> は尤度関数と呼ばれる。
最尤法とは尤度関数 <span class="math notranslate nohighlight">\(P(\mathbf{w})\)</span> を最大にするパラメータ
<span class="math notranslate nohighlight">\(\mathbf{w}^*\)</span> を推定値とする手法である。
簡単のため<span class="math notranslate nohighlight">\(P(\mathbf{w})\)</span>を最大化するのではなく、
<span class="math notranslate nohighlight">\(-\log P(\mathbf{w})\)</span>
すなわち</p>
<div class="math notranslate nohighlight">
\[
  L(\mathbf{w}) = -\sum_{i=1}^N\left\{y_i\log(P(C_1 | \mathbf{x}_i ; \mathbf{w})) + (1 - y_i)\log(1-P(C_1 | \mathbf{x}_i ; \mathbf{w}))\right\}
\]</div>
<p>の最小化問題を解く。
この <span class="math notranslate nohighlight">\(L(\mathbf{w})\)</span> がロジスティック回帰における損失関数となる．
あとは</p>
<div class="math notranslate nohighlight">
\[
  \nabla L(\mathbf{w}) = \sum_{i=1}^N(P(C_1 | \mathbf{x}_i ; \mathbf{w}) - y_i)\mathbf{x}_i
\]</div>
<p>であることを使って、確率的勾配降下法などを用いて最適解 <span class="math notranslate nohighlight">\(\mathbf{w}^*\)</span> を求めればよい。</p>
<p>ロジスティック回帰はscikit-learnの<code class="docutils literal notranslate"><span class="pre">LogisticRegression</span></code>クラス（<a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.LogisticRegression.html">https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.LogisticRegression.html</a> ） で実行できる。<code class="docutils literal notranslate"><span class="pre">SGDClassfication</span></code>クラス（<a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.SGDClassifier.html">https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.SGDClassifier.html</a> ）で<code class="docutils literal notranslate"><span class="pre">loss=</span> <span class="pre">log</span></code>オプションを指定してもよい。</p>
<p>特徴量と正解の作成</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X1_df</span> <span class="o">=</span> <span class="n">cancer_df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;diagnosis&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y1_df</span> <span class="o">=</span> <span class="n">cancer_df</span><span class="p">[</span><span class="s1">&#39;diagnosis&#39;</span><span class="p">]</span>
<span class="n">X1_np</span> <span class="o">=</span> <span class="n">X1_df</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">y1_np</span> <span class="o">=</span> <span class="n">y1_df</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>訓練データとテストデータに分ける</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X1_train</span><span class="p">,</span> <span class="n">X1_test</span><span class="p">,</span> <span class="n">y1_train</span><span class="p">,</span> <span class="n">y1_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X1_np</span><span class="p">,</span> <span class="n">y1_np</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>分類問題では原則として特徴量はスケーリングする。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scaler1</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
<span class="n">scaler1</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X1_train</span><span class="p">)</span>
<span class="n">X1_train_scaled</span> <span class="o">=</span> <span class="n">scaler1</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X1_train</span><span class="p">)</span>
<span class="n">X1_test_scaled</span> <span class="o">=</span> <span class="n">scaler1</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X1_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>LogisticRegressionの引数<code class="docutils literal notranslate"><span class="pre">C</span></code>は正則化の強さを表す係数。<code class="docutils literal notranslate"><span class="pre">Ridge</span></code>クラスなどの場合と異なり、<strong><code class="docutils literal notranslate"><span class="pre">C</span></code>が小さいほど正則化項の影響が強くなる</strong>。
LogsiticRegressionクラスではデフォルトで<span class="math notranslate nohighlight">\(L^2\)</span>正則化（<span class="math notranslate nohighlight">\(\sum w_i^2\)</span> が正則化項）を行う。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">logreg</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">()</span>
<span class="n">logreg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X1_train_scaled</span><span class="p">,</span> <span class="n">y1_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LogisticRegression()
</pre></div>
</div>
</div>
</div>
<p>係数を見てみる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">colnames</span> <span class="o">=</span> <span class="n">X1_df</span><span class="o">.</span><span class="n">columns</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">logreg</span><span class="o">.</span><span class="n">coef_</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">colnames</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
  <div id="df-c2da5e67-80f1-4da9-bb1b-95b095b6266b">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>radius_mean</th>
      <td>-0.411539</td>
    </tr>
    <tr>
      <th>texture_mean</th>
      <td>-0.496407</td>
    </tr>
    <tr>
      <th>perimeter_mean</th>
      <td>-0.407902</td>
    </tr>
    <tr>
      <th>area_mean</th>
      <td>-0.465748</td>
    </tr>
    <tr>
      <th>smoothness_mean</th>
      <td>0.081338</td>
    </tr>
    <tr>
      <th>compactness_mean</th>
      <td>0.733878</td>
    </tr>
    <tr>
      <th>concavity_mean</th>
      <td>-0.735437</td>
    </tr>
    <tr>
      <th>concave points_mean</th>
      <td>-0.867126</td>
    </tr>
    <tr>
      <th>symmetry_mean</th>
      <td>-0.100873</td>
    </tr>
    <tr>
      <th>fractal_dimension_mean</th>
      <td>0.099019</td>
    </tr>
    <tr>
      <th>radius_se</th>
      <td>-1.078195</td>
    </tr>
    <tr>
      <th>texture_se</th>
      <td>0.141077</td>
    </tr>
    <tr>
      <th>perimeter_se</th>
      <td>-0.840552</td>
    </tr>
    <tr>
      <th>area_se</th>
      <td>-0.930845</td>
    </tr>
    <tr>
      <th>smoothness_se</th>
      <td>-0.261771</td>
    </tr>
    <tr>
      <th>compactness_se</th>
      <td>0.597715</td>
    </tr>
    <tr>
      <th>concavity_se</th>
      <td>0.173739</td>
    </tr>
    <tr>
      <th>concave points_se</th>
      <td>-0.210750</td>
    </tr>
    <tr>
      <th>symmetry_se</th>
      <td>0.394944</td>
    </tr>
    <tr>
      <th>fractal_dimension_se</th>
      <td>0.508884</td>
    </tr>
    <tr>
      <th>radius_worst</th>
      <td>-0.915370</td>
    </tr>
    <tr>
      <th>texture_worst</th>
      <td>-1.059965</td>
    </tr>
    <tr>
      <th>perimeter_worst</th>
      <td>-0.864128</td>
    </tr>
    <tr>
      <th>area_worst</th>
      <td>-0.905654</td>
    </tr>
    <tr>
      <th>smoothness_worst</th>
      <td>-0.477404</td>
    </tr>
    <tr>
      <th>compactness_worst</th>
      <td>0.019162</td>
    </tr>
    <tr>
      <th>concavity_worst</th>
      <td>-0.735512</td>
    </tr>
    <tr>
      <th>concave points_worst</th>
      <td>-0.986628</td>
    </tr>
    <tr>
      <th>symmetry_worst</th>
      <td>-0.808970</td>
    </tr>
    <tr>
      <th>fractal_dimension_worst</th>
      <td>-0.700537</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-c2da5e67-80f1-4da9-bb1b-95b095b6266b')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-c2da5e67-80f1-4da9-bb1b-95b095b6266b button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-c2da5e67-80f1-4da9-bb1b-95b095b6266b');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
</div></div>
</div>
<p>スコアを計算する</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">logreg</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X1_test_scaled</span><span class="p">,</span> <span class="n">y1_test</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">logreg</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X1_train_scaled</span><span class="p">,</span> <span class="n">y1_train</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.986013986013986
0.9859154929577465
</pre></div>
</div>
</div>
</div>
<p>新しい細胞データ</p>
<p>newX= [18, 10, 122, 1000, 0.1, 0.2, 0.3, 0.1, 0.2, 0.07, 1, 0.9, 8, 153, 0.006, 0.04, 0.05, 0.01, 0.03, 0.006, 25, 17, 184, 2019, 0.1, 0.6, 0.7, 0.2, 0.4, 0.1]</p>
<p>が悪性（0）から良性（1）か調べる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">newX</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">18</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">122</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.07</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mf">0.006</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.006</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">184</span><span class="p">,</span> <span class="mi">2019</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">newX_scaled</span> <span class="o">=</span> <span class="n">scaler1</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">newX</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">logreg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">newX_scaled</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([0])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">logreg</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">newX_scaled</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[9.99999801e-01, 1.98539213e-07]])
</pre></div>
</div>
</div>
</div>
<p>悪性であることが分かる。</p>
</div>
<div class="section" id="id7">
<h3>多クラス分類<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<p>アヤメ（iris）のデータ <a class="reference external" href="https://drive.google.com/file/d/10Bjm4kA8f-Bg2DiKgPcJSXq7gJF4gHOA/view?usp=sharing">iris.csv</a>を使ってアヤメの品種分類を行う。3つの品種があるので、<strong>多クラス分類</strong>となる。
このデータはアヤメの特徴</p>
<ul class="simple">
<li><p>Sepal Length がく片の長さ</p></li>
<li><p>Sepal Width がく片の幅</p></li>
<li><p>Petal length 花びらの長さ</p></li>
<li><p>petal Width 花びらの幅</p></li>
</ul>
<p>と、その品種</p>
<ol class="simple">
<li><p>Setosa</p></li>
<li><p>Versicolor</p></li>
<li><p>Virginica</p></li>
</ol>
<p>が含まれている。これらの特徴量から品種をロジスティック回帰を使って予測したい。</p>
<p>多クラス分類の場合はシグモイド関数の代わりに<strong>ソフトマックス関数</strong>を使って、係数を推定する。一般に、<span class="math notranslate nohighlight">\(K\)</span>クラス分類の場合には <span class="math notranslate nohighlight">\(K\)</span> 個の線形関数
<span class="math notranslate nohighlight">\(y_k =\mathbf{w}_k^T \mathbf{x}\)</span>
を用いて識別をする。
ここで、<span class="math notranslate nohighlight">\(\mathbf{w}_k=(w_{k0},w_{k1},…,w_{kD})^T\)</span> である。
この場合には、シグモイド関数の代わりにソフトマックス関数を使って</p>
<div class="math notranslate nohighlight">
\[
  P(C_k|\mathbf{x}) = \frac{\exp\left(\mathbf{w}_k^T \mathbf{x}\right)}{\sum_{j=1}^K \exp\left(\mathbf{w}_j^T \mathbf{x}\right)}
\]</div>
<p>として、最尤法を用いてパラメータ<span class="math notranslate nohighlight">\(\{\mathbf{w}_k^*\}_{k=1,…,K}\)</span>
を推定すればよい。
そして，特徴量<span class="math notranslate nohighlight">\(\mathbf{x}\)</span>を<span class="math notranslate nohighlight">\(\mathbf{w}_k^*\)</span>を用いて計算した
<span class="math notranslate nohighlight">\(P(C_k|\mathbf{x})\)</span>が最も大きくなるクラスに分類すればよい．</p>
<p>多クラス分類になっても <code class="docutils literal notranslate"><span class="pre">LogisticRegression</span></code>の使い方はほとんど変わらない。</p>
<p>irisデータの読み込みと先頭の確認。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">iris_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">iris_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
  <div id="df-4b6d1507-eaf8-40f2-8034-dddae93b82e8">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>SepalLengthCm</th>
      <th>SepalWidthCm</th>
      <th>PetalLengthCm</th>
      <th>PetalWidthCm</th>
      <th>Species</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>5.1</td>
      <td>3.5</td>
      <td>1.4</td>
      <td>0.2</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>4.9</td>
      <td>3.0</td>
      <td>1.4</td>
      <td>0.2</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>4.7</td>
      <td>3.2</td>
      <td>1.3</td>
      <td>0.2</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4.6</td>
      <td>3.1</td>
      <td>1.5</td>
      <td>0.2</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5.0</td>
      <td>3.6</td>
      <td>1.4</td>
      <td>0.2</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-4b6d1507-eaf8-40f2-8034-dddae93b82e8')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-4b6d1507-eaf8-40f2-8034-dddae93b82e8 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-4b6d1507-eaf8-40f2-8034-dddae93b82e8');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
</div></div>
</div>
<p>データの図示する。ここでは、seabornライブラリの<code class="docutils literal notranslate"><span class="pre">pairplot</span></code>を使ってみる。<a class="reference external" href="https://seaborn.pydata.org/generated/seaborn.pairplot.html">https://seaborn.pydata.org/generated/seaborn.pairplot.html</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">pairplot</span><span class="p">(</span><span class="n">iris_df</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;Species&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;seaborn.axisgrid.PairGrid at 0x7fc7c0df1750&gt;
</pre></div>
</div>
<img alt="_images/11CompFin_58_1.png" src="_images/11CompFin_58_1.png" />
</div>
</div>
<p>特徴量と正解の作成。<code class="docutils literal notranslate"><span class="pre">Species</span></code>が正解になる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X2_df</span> <span class="o">=</span> <span class="n">iris_df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;Species&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y2_df</span> <span class="o">=</span> <span class="n">iris_df</span><span class="p">[</span><span class="s1">&#39;Species&#39;</span><span class="p">]</span>
<span class="n">X2_np</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">X2_df</span><span class="p">)</span>
<span class="n">y2_np</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y2_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>訓練データとテストデータに分ける</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X2_train</span><span class="p">,</span> <span class="n">X2_test</span><span class="p">,</span> <span class="n">y2_train</span><span class="p">,</span> <span class="n">y2_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X2_np</span><span class="p">,</span> <span class="n">y2_np</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>特徴量のスケーリング</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scaler2</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
<span class="n">scaler2</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X2_train</span><span class="p">)</span>
<span class="n">X2_train_scaled</span> <span class="o">=</span> <span class="n">scaler2</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X2_train</span><span class="p">)</span>
<span class="n">X2_test_scaled</span> <span class="o">=</span> <span class="n">scaler2</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X2_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>ロジスティック回帰の実行</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">logreg2</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">()</span>
<span class="n">logreg2</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X2_train_scaled</span><span class="p">,</span> <span class="n">y2_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LogisticRegression()
</pre></div>
</div>
</div>
</div>
<p>係数の表示。3つの係数の組み合わせが3つあることに注意。3本の直線で分類をしていることを表す。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">logreg2</span><span class="o">.</span><span class="n">coef_</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">logreg2</span><span class="o">.</span><span class="n">intercept_</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[-1.01571659  1.02410111 -1.75072341 -1.63287316]
 [ 0.62231946 -0.38976498 -0.29342776 -0.80609972]
 [ 0.39339713 -0.63433613  2.04415117  2.43897288]]
[-0.39408557  1.71061118 -1.31652561]
</pre></div>
</div>
</div>
</div>
<p>スコアの計算</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">logreg2</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X2_test_scaled</span><span class="p">,</span> <span class="n">y2_test</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">logreg2</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X2_train_scaled</span><span class="p">,</span> <span class="n">y2_train</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.9736842105263158
0.9732142857142857
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="k-means">
<h2>教師なし学習: k-means法によるクラスタリング<a class="headerlink" href="#k-means" title="Permalink to this headline">¶</a></h2>
<p>正解が与えられないデータに関する学習を<strong>教師なし学習</strong>という。教師なし学習にはクラスタリングや次元削減などのタスクがある。ここでは、クラスタリングを扱う。クラスタリングは与えられたデータを、類似したデータ群に分割することである。</p>
<p><strong>k-means法</strong>によりクラスタリングを行う。k-means法は以下のアルゴリズムによりデータを分割する。k-means法では何個のクラスタに分割するか、あらかじめ決めておく必要がある。<span class="math notranslate nohighlight">\(K\)</span>個のクラスタに分割するとする。また、データは<span class="math notranslate nohighlight">\(D\)</span>個の特徴量を持つとする。</p>
<ol class="simple">
<li><p><span class="math notranslate nohighlight">\(K\)</span>個のクラスタの重心<span class="math notranslate nohighlight">\(\mu_k\)</span>（<span class="math notranslate nohighlight">\(k=1, 2, \dots, K\)</span>）をランダムに選ぶ。</p></li>
<li><p>各データ<span class="math notranslate nohighlight">\(\mathbf{x}_n\)</span>を最も近い重心<span class="math notranslate nohighlight">\(\mu_k\)</span>のクラスタに割り当てる。すなわち、<span class="math notranslate nohighlight">\(\mathbf{x}_n\)</span>のクラスタを <span class="math notranslate nohighlight">\(z_n^* = \mathop{argmin}_k \sum_{j=1}^D(x_{jn} - \mu_{jk})^2\)</span> とする。</p></li>
<li><p>こうしてできたクラスタの重心を新たに <span class="math notranslate nohighlight">\(\mu_k = \frac{1}{N_k}\sum_{n: z_n = k}\mathbf{x}_n\)</span>と定義する。<span class="math notranslate nohighlight">\(N_k\)</span>はクラスタ<span class="math notranslate nohighlight">\(k\)</span>に含まれるデータの個数。</p></li>
<li><p>クラスタの割合が変化しなくなるまで、2と3を繰り返す。</p></li>
</ol>
<p>scikit-learnライブラリの<code class="docutils literal notranslate"><span class="pre">KMeans</span></code>クラスでk-means法を実行できる。irisデータを3つのクラスタに分割してみよう。</p>
<p>一般にはスケーリングしたほうがよいが、irisデータはほぼスケールが揃っているので、ここでは省略する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.cluster</span> <span class="kn">import</span> <span class="n">KMeans</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">kmeans</span> <span class="o">=</span> <span class="n">KMeans</span><span class="p">(</span><span class="n">n_clusters</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">kmeans</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X2_np</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>KMeans(n_clusters=4)
</pre></div>
</div>
</div>
</div>
<p>結果を表示</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">kmeans</span><span class="o">.</span><span class="n">labels_</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
       0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
       0, 0, 0, 0, 0, 0, 1, 1, 1, 3, 1, 3, 1, 3, 1, 3, 3, 3, 3, 1, 3, 1,
       3, 3, 1, 3, 1, 3, 1, 1, 1, 1, 1, 1, 1, 3, 3, 3, 3, 1, 3, 1, 1, 1,
       3, 3, 3, 1, 3, 3, 3, 3, 3, 1, 3, 3, 2, 1, 2, 2, 2, 2, 3, 2, 2, 2,
       1, 1, 2, 1, 1, 2, 2, 2, 2, 1, 2, 1, 2, 1, 2, 2, 1, 1, 2, 2, 2, 2,
       2, 1, 1, 2, 2, 2, 1, 2, 2, 2, 1, 2, 2, 2, 1, 1, 2, 1], dtype=int32)
</pre></div>
</div>
</div>
</div>
<p>正解と比較</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y2_np</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
       0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
       0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
       1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
       1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
       2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
       2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2])
</pre></div>
</div>
</div>
</div>
<p>散布図を描くために、特徴量<code class="docutils literal notranslate"><span class="pre">X3_df</span></code>と結果<code class="docutils literal notranslate"><span class="pre">labels</span></code>を1つのデータフレームにまとめる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">labels</span> <span class="o">=</span> <span class="n">kmeans</span><span class="o">.</span><span class="n">labels_</span>
<span class="n">result_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">X2_df</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;result&#39;</span><span class="p">])],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
  <div id="df-1ab2365f-8746-41aa-9ab3-6987baab4313">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>SepalLengthCm</th>
      <th>SepalWidthCm</th>
      <th>PetalLengthCm</th>
      <th>PetalWidthCm</th>
      <th>result</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>5.1</td>
      <td>3.5</td>
      <td>1.4</td>
      <td>0.2</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>4.9</td>
      <td>3.0</td>
      <td>1.4</td>
      <td>0.2</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>4.7</td>
      <td>3.2</td>
      <td>1.3</td>
      <td>0.2</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4.6</td>
      <td>3.1</td>
      <td>1.5</td>
      <td>0.2</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5.0</td>
      <td>3.6</td>
      <td>1.4</td>
      <td>0.2</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-1ab2365f-8746-41aa-9ab3-6987baab4313')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-1ab2365f-8746-41aa-9ab3-6987baab4313 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-1ab2365f-8746-41aa-9ab3-6987baab4313');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
</div></div>
</div>
<p>seabornライブラリの<code class="docutils literal notranslate"><span class="pre">pairplot</span></code>で散布図を描く。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">pairplot</span><span class="p">(</span><span class="n">result_df</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;result&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;seaborn.axisgrid.PairGrid at 0x7fc7b74bd790&gt;
</pre></div>
</div>
<img alt="_images/11CompFin_82_1.png" src="_images/11CompFin_82_1.png" />
</div>
</div>
<p>k-means法の問題として、あらかじめクラスタの数<span class="math notranslate nohighlight">\(K\)</span>を指定しなければならないことがある。
クラスタリングの良さの指標として慣性（inertia）が使われる。慣性とは各データと最短重心の二乗距離の和である。
各データが最短重心に近いほど、慣性は小さくなる。</p>
<p>クラスタ数<span class="math notranslate nohighlight">\(K\)</span>と慣性の関係を調べて、慣性があまり減少しなくなる<span class="math notranslate nohighlight">\(K\)</span>（エルボー）
を選ぶ。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">inertia_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">kmeans</span> <span class="o">=</span> <span class="n">KMeans</span><span class="p">(</span><span class="n">n_clusters</span><span class="o">=</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>
    <span class="n">kmeans</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X2_np</span><span class="p">)</span>
    <span class="n">inertia_data</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">kmeans</span><span class="o">.</span><span class="n">inertia_</span>
</pre></div>
</div>
</div>
</div>
<p>グラフを描く</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;K&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;inertia&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">inertia_data</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/11CompFin_86_0.png" src="_images/11CompFin_86_0.png" />
</div>
</div>
<p><span class="math notranslate nohighlight">\(K=3\)</span>あたりから慣性があまり減少しなくなる。</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="10CompFin.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">第10回 機械学習入門1 線形回帰モデル</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="12CompFin.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">第12回 機械学習入門3 決定木</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      著者 上村昌司 (kamimura@reitaku-u.ac.jp)<br/>
    
        &copy; Copyright 2021.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>